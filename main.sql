-- (2) 查询未选修课程“EE-01”的男生学号、成绩。
SELECT DISTINCT JSJ46_S137.S#, JSJ46_SC137.GRADE
FROM JSJ46_SC137 INNER JOIN
JSJ46_S137 ON JSJ46_SC137.S# = JSJ46_S137.S#
WHERE (JSJ46_S137.SEX = '男') AND (JSJ46_SC137.C# <> 'EE-01');
-- (3) 查询 1992 年～1994 年出生的学生的基本信息。
SELECT S#, SNAME, CONVERT(CHAR(10), BDATE, 21) AS BDATE, SEX, HEIGHT,
DORM
FROM JSJ46_S137
WHERE (YEAR(BDATE) >= 1992) AND (YEAR(BDATE) <= 1994);
-- (4) 查询每位学生的学号、学生姓名及其已修学分数。
SELECT JSJ46_S137.S#, JSJ46_S137.SNAME, SUM(JSJ46_C137.CREDIT)
AS CREDIT
FROM JSJ46_SC137 INNER JOIN
JSJ46_C137 ON JSJ46_SC137.C# = JSJ46_C137.C# INNER JOIN
JSJ46_S137 ON JSJ46_SC137.S# = JSJ46_S137.S#
GROUP BY JSJ46_S137.S#, JSJ46_S137.SNAME;
-- (5) 查询选修课程“CS-01”的学生中成绩第二高的学生学号。
SELECT DISTINCT JSJ46_SC137.S#
FROM JSJ46_SC137 INNER JOIN
JSJ46_S137 ON JSJ46_SC137.S# = JSJ46_S137.S#
WHERE (JSJ46_SC137.C# = 'CS-01') AND (JSJ46_SC137.GRADE IN
(SELECT MAX(GRADE)
FROM JSJ46_SC137
WHERE C# = 'CS-01' AND (GRADE <>
(SELECT MAX(GRADE)
FROM JSJ46_SC137
WHERE C# = 'CS-01'))));
-- (6) 查询平均成绩超过“王涛“同学的学生学号、姓名和平均成绩，并按学号进行降序排列。
SELECT JSJ46_SC137.S#, JSJ46_S137.SNAME, cast(AVG(GRADE) AS decimal(4, 2))
AS AVG
FROM JSJ46_SC137 INNER JOIN
JSJ46_S137 ON JSJ46_SC137.S# = JSJ46_S137.S#
GROUP BY JSJ46_SC137.S#, JSJ46_S137.SNAME
HAVING (AVG(JSJ46_SC137.GRADE) >
(SELECT AVG(GRADE)
FROM JSJ46_SC137 INNER JOIN
JSJ46_S137 ON JSJ46_SC137.S# = JSJ46_S137.S#
WHERE SNAME = '王涛'))
ORDER BY JSJ46_SC137.S# DESC;
-- (7) 查询选修了 3 门以上课程（包括 3 门）的学生中平均成绩最高的同学学号及姓名。
SELECT DISTINCT JSJ46_SC137.S#, JSJ46_S137.SNAME
FROM JSJ46_SC137 INNER JOIN
JSJ46_S137 ON JSJ46_SC137.S# = JSJ46_S137.S#
GROUP BY JSJ46_SC137.S#, JSJ46_S137.SNAME
HAVING (COUNT(JSJ46_SC137.C#) >= 3) AND (AVG(JSJ46_SC137.GRADE) >= ALL
(SELECT AVG(JSJ46_SC137.GRADE)
FROM JSJ46_SC137
GROUP BY JSJ46_SC137.S#
HAVING COUNT(JSJ46_SC137.C#) >= 3));
-- 2．分别在 JSJ4*_S×××（WLW41_S×××，DXS41_S×××，SNB41_S×××）和 JSJ4*_C×××（WLW41_C×××，DXS41_C×××，SNB41_C×××）表中加入记录(‘01032005’，‘刘竞’，‘男’，‘1993-12-10’，1.75，‘东 14舍 312’)及(‘CS03’，“离散数学”，64，4，‘陈建明’)。
-- 3．将 JSJ4*_S×××（WLW41_S×××，DXS41_S×××，SNB41_S×××）表中已修学分数大于 110 的学生记录删除。
DELETE FROM JSJ46_S137
WHERE (S# IN
(SELECT S#
FROM JSJ46_C137, JSJ46_SC137
WHERE JSJ46_C137.C# = JSJ46_SC137.C#
GROUP BY S#
HAVING SUM(CREDIT) > 110));
-- 4．将“张明”老师负责的“信号与系统”课程的学时数调整为 56，同时增加一个学分。
UPDATE JSJ46_C137
SET PERIOD = 56, CREDIT = CREDIT + 1
WHERE (TEACHER = '张明') AND (CNAME = '信号与系统');
-- 5．建立如下视图：
-- (1)居住在“东 18 舍”的男生视图，包括学号、姓名、出生日期、身高等属性。
CREATE VIEW A AS SELECT S#, SNAME, BDATE, HEIGHT
FROM JSJ46_S137
WHERE SEX = '男' AND DORM LIKE '东 18 舍%';
-- (2)“张明”老师所开设课程情况的视图，包括课程编号、课程名称、平均成绩等属性。
CREATE VIEW B(C#, CNAME, AVG_G) AS SELECT JSJ46_C137.C#, CNAME,
cast(AVG(GRADE) AS
DECIMAL(4, 2))
FROM JSJ46_SC137, JSJ46_C137
WHERE TEACHER = '张明' AND
JSJ46_C137.C# = JSJ46_SC137.C#
GROUP BY JSJ46_C137.C#, CNAME;
-- (3)所有选修了“人工智能”课程的学生视图，包括学号、姓名、成绩等属性。
CREATE VIEW AI AS SELECT JSJ46_S137.S#, SNAME, GRADE
FROM JSJ46_S137, JSJ46_C137, JSJ46_SC137
WHERE CNAME = '人工智能' AND
JSJ46_C137.C# = JSJ46_SC137.C# AND
JSJ46_S137.S# = JSJ46_SC137.S#;
